<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mon compte · Groupie Tracker</title>
    <link rel="stylesheet" href="/static/CSS/styles.css">
    <style>
      .user-menu button:hover { opacity: 0.8; }
      #profileDropdown a:hover, #profileDropdown button:hover { background: var(--card-bg); }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; gap: 2rem;">
          <div class="brand">
            <h1>
              <img src="/static/pictures/logo_V3-re.png" alt="Groupie Tracker" class="logo">
            </h1>
          </div>
          <nav class="nav" aria-label="Main navigation">
            {{if .User}}
            <div style="display: flex; align-items: center; gap: 1rem;">
              <a href="/home" class="nav-link">Artistes</a>
              <a href="/profile" class="nav-link">Mon compte</a>
              {{if eq .User.Role "admin"}}
              <a href="/admin/users" class="nav-link" style="color: var(--gold); font-weight: 600;">Administration</a>
              {{end}}
              <div class="user-menu" style="position: relative;">
                <button id="profileBtn" class="nav-link" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                  {{if .User.PhotoProfil}}
                  <img src="{{.User.PhotoProfil}}" alt="Photo de profil" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                  {{else}}
                  <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--gold); display: flex; align-items: center; justify-content: center; color: var(--bg); font-weight: bold;">
                    {{substr .User.Username 0 1 | upper}}
                  </div>
                  {{end}}
                  <span>{{if .User.Pseudo}}{{.User.Pseudo}}{{else}}{{.User.Username}}{{end}}</span>
                </button>
                <div id="profileDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: var(--bg); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem; margin-top: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000;">
                  <a href="/profile" style="display: block; padding: 0.5rem; color: var(--foreground); text-decoration: none; border-radius: 0.25rem;">Gérer mon compte</a>
                  <form method="POST" action="/logout" style="margin: 0;">
                    <button type="submit" style="width: 100%; text-align: left; padding: 0.5rem; background: none; border: none; color: var(--foreground); cursor: pointer; border-radius: 0.25rem;">Déconnexion</button>
                  </form>
                </div>
              </div>
            </div>
            {{else}}
            <a href="/login" class="nav-link nav-login">Se connecter</a>
            {{end}}
          </nav>
        </div>
      </div>
    </header>

    <main class="container" style="padding-top: 2rem;">
      {{if .User}}
      <section style="background: var(--card-bg); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--border);">
        <h2 style="margin-bottom: 1.5rem; color: var(--gold);">Gestion de mon compte</h2>
        <form method="POST" action="/profile/update" enctype="multipart/form-data" style="display: grid; gap: 1.5rem;">
          <div style="display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;">
            <div style="flex: 0 0 auto;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Photo de profil</label>
              {{if .User.PhotoProfil}}
              <img src="{{.User.PhotoProfil}}" alt="Photo actuelle" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 0.5rem; border: 2px solid var(--gold);">
              {{else}}
              <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--gold); display: flex; align-items: center; justify-content: center; color: var(--bg); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">
                {{substr .User.Username 0 1 | upper}}
              </div>
              {{end}}
              <input type="file" name="photo_profil" accept="image/*" style="font-size: 0.9rem;">
            </div>
            <div style="flex: 1; min-width: 250px;">
              <div style="margin-bottom: 1rem;">
                <label for="pseudo" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Pseudo</label>
                <input type="text" id="pseudo" name="pseudo" value="{{if .User.Pseudo}}{{.User.Pseudo}}{{else}}{{.User.Username}}{{end}}" placeholder="Votre pseudo" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg); color: var(--foreground); font-size: 1rem;">
              </div>
              <div>
                <label for="bio" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Bio</label>
                <textarea id="bio" name="bio" rows="4" placeholder="Parlez-nous de vous..." style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg); color: var(--foreground); font-size: 1rem; font-family: inherit; resize: vertical;">{{.User.Bio}}</textarea>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 1rem; align-items: center;">
            <button type="submit" style="padding: 0.75rem 2rem; background: var(--gradient-gold); color: var(--bg); border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; font-size: 1rem;">Enregistrer les modifications</button>
            <div style="color: var(--muted); font-size: 0.9rem;">
              <strong>Email:</strong> {{.User.Email}}
            </div>
          </div>
        </form>
      </section>
      {{end}}
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-links">
          <a href="/legal/conditions">Conditions générales de vente</a>
          <a href="/legal/privacy">Vos informations personnelles</a>
          <a href="/legal/cookies">Cookies</a>
          <a href="/legal/mentions">Mentions légales</a>
        </div>
        <div class="footer-copyright">
          <p>© 2025, Groupie Tracker. Tous droits réservés.</p>
          <p style="font-size: 0.875rem; margin-top: 0.5rem; color: var(--muted);">Propulsé par l'API <a href="https://groupietrackers.herokuapp.com/api" style="color: var(--gold);">Groupie Tracker</a></p>
        </div>
      </div>
    </footer>

    {{if .User}}
    <script>
      document.getElementById('profileBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        var dropdown = document.getElementById('profileDropdown');
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
      });
      document.addEventListener('click', function() {
        document.getElementById('profileDropdown').style.display = 'none';
      });
    </script>
    {{end}}
  </body>
</html>


