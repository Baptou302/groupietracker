<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Groupie Tracker</title>
    <link rel="stylesheet" href="/static/CSS/styles.css">
    <style>
      .user-menu button:hover { opacity: 0.8; }
      #profileDropdown a:hover, #profileDropdown button:hover { background: var(--card-bg); }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; gap: 2rem;">
          <div class="brand">
            <h1>
              <img src="/static/pictures/logo_V3-re.png" alt="Groupie Tracker" class="logo">
            </h1>
          </div>
          <nav class="nav" aria-label="Main navigation">
            {{if .User}}
            <div style="display: flex; align-items: center; gap: 1rem;">
              <a href="/home" class="nav-link">Artistes</a>
              {{if eq .User.Role "admin"}}
              <a href="/admin/users" class="nav-link" style="color: var(--gold); font-weight: 600;">Administration</a>
              {{end}}
              <div class="user-menu" style="position: relative;">
                <button id="profileBtn" class="nav-link" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                  {{if .User.PhotoProfil}}
                  <img src="{{.User.PhotoProfil}}" alt="Photo de profil" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                  {{else}}
                  <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--gold); display: flex; align-items: center; justify-content: center; color: var(--bg); font-weight: bold;">
                    {{substr .User.Username 0 1 | upper}}
                  </div>
                  {{end}}
                  <span>{{if .User.Pseudo}}{{.User.Pseudo}}{{else}}{{.User.Username}}{{end}}</span>
                </button>
                <div id="profileDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: var(--bg); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem; margin-top: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000;">
                  <a href="/profile" style="display: block; padding: 0.5rem; color: var(--foreground); text-decoration: none; border-radius: 0.25rem;">Gérer mon compte</a>
                  <form method="POST" action="/logout" style="margin: 0;">
                    <button type="submit" style="width: 100%; text-align: left; padding: 0.5rem; background: none; border: none; color: var(--foreground); cursor: pointer; border-radius: 0.25rem;">Déconnexion</button>
                  </form>
                </div>
              </div>
            </div>
            {{else}}
            <a href="/login" class="nav-link nav-login">Se connecter</a>
            <a href="/" class="nav-link">Artistes</a>
            {{end}}
          </nav>
        </div>
        <form class="search-form" method="get" action="/">
          <label>
            <span class="sr-only">Recherche</span>
            <input type="search" name="q" placeholder="Nom, membre, pays..." value="{{.Query}}">
          </label>
          <button type="submit">Rechercher</button>
          {{if .Query}}
          <a class="reset" href="/">Réinitialiser</a>
          {{end}}
        </form>
      </div>
    </header>
    <main class="container">
      <section class="hero">
        <div class="hero-banner">
          <div class="hero-content">
            <h1 class="brand">Découvrez les <span class="gold-text-gradient">légendes</span> de la musique</h1>
            <p>Explorez un catalogue interactif et complet des artistes les plus influents, alimenté par l'API Groupie Tracker</p>
          </div>
        </div>
      </section>
      <section class="stats">
        <p>
          <strong>{{.Count}}</strong> artiste{{if ne .Count 1}}s{{end}} affiché{{if ne .Count 1}}s{{end}}
          sur <strong>{{.Total}}</strong> disponibles
        </p>
        <form method="post" action="/refresh">
          <button type="submit">Actualiser depuis l'API</button>
        </form>
      </section>
      {{if .Artists}}
      <section class="grid">
        {{range .Artists}}
        <article class="card">
          <a href="/artist?id={{.ID}}">
            <div class="thumb">
              <img src="{{.Image}}" alt="Photo de {{.Name}}">
            </div>
            <div class="card-body">
              <h2>{{.Name}}</h2>
              <p>Création&nbsp;: {{.CreationDate}}</p>
              <p>Premier album&nbsp;: {{formatDate .FirstAlbum}}</p>
              <p>Membres&nbsp;: {{joinMembers .Members}}</p>
            </div>
          </a>
        </article>
        {{end}}
      </section>
      {{else}}
      <p class="empty">Aucun résultat pour «&nbsp;{{.Query}}&nbsp;».</p>
      {{end}}
    </main>
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-links">
          <a href="/legal/conditions">Conditions générales de vente</a>
          <a href="/legal/privacy">Vos informations personnelles</a>
          <a href="/legal/cookies">Cookies</a>
          <a href="/legal/mentions">Mentions légales</a>
        </div>
        <div class="footer-copyright">
          <p>© 2025, Groupie Tracker. Tous droits réservés.</p>
          <p style="font-size: 0.875rem; margin-top: 0.5rem; color: var(--muted);">Propulsé par l'API <a href="https://groupietrackers.herokuapp.com/api" style="color: var(--gold);">Groupie Tracker</a></p>
        </div>
      </div>
    </footer>
    {{if .User}}
    <script>
      document.getElementById('profileBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        var dropdown = document.getElementById('profileDropdown');
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
      });
      document.addEventListener('click', function() {
        document.getElementById('profileDropdown').style.display = 'none';
      });
    </script>
    {{end}}
  </body>
</html>

